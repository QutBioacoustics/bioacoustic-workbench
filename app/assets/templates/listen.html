<div id="content" data-ng-controller="ListenCtrl">

    <a href="/listen/1bd0d668-1471-4396-adc3-09ccd8fe949a">demo</a>
    <a href="/listen/">demo empty</a>

    <div ng-show="errorState">
        Something has gone wrong - can't load this page.
    </div>
    <div ng-hide="errorState">
        <h1>Listen</h1>

        <p>Listen and annotate.</p>

        <h3>Spectrogram</h3>
        <baw-annotation-viewer model="model"></baw-annotation-viewer>

        <h3>Audio Controls</h3>
        <audio id="main-player" controls>
            <source ng-repeat="url in model.media.audioUrls" ng-src="{{url}}" src="">
            Your browser does not support the audio element.
        </audio>
        <div id="listenEditContainer">
            <div id="listenEditColumn">
                <h3>
                    Annotation edit
                </h3>
                <span>Selected elements: {{model.selectedAudioEvents.length}}</span>

                <form id="annotationEditForm" name="annotationEditForm"
                      ng-repeat="selectedEvent in model.selectedAudioEvents">
                    <label>
                        <span>Tags</span>
                        <input type="hidden" ng-multiple="true" tags multiple ui-select2="{allowClear:true, tags:tags }"
                                ng-model="selectedEvent.audioEventTags" />
                            <!--<option ng-repeat="t in tags" value="{{t.id}}">{{t.text}} <span> &lt;!&ndash; ng-show={{t.type_of_tag}}&ndash;&gt;,-->
                        <!--{{t.typeOfTag}} &lt;!&ndash; &ndash;&gt;</span></option>-->

                    </label>
                    <label>
                        <span>Duration (seconds)</span></label>
                    <input type="number" min="{{limits.timeMin}}" max="{{limits.timeMax}}" required
                           ng-model="selectedEvent.startTimeSeconds"/>
                    &nbsp;to&nbsp;
                    <input type="number" min="{{limits.timeMin}}" max="{{limits.timeMax}}" required
                           ng-model="selectedEvent.endTimeSeconds"/>
                    <label>
                        <span>Frequency</span> </label>
                    <input type="number" min="{{limits.freqMin}}" max="{{limits.freqMax}}" required
                           ng-model="selectedEvent.lowFrequencyHertz"/>
                    &nbsp;to&nbsp;
                    <input type="number" min="{{limits.freqMin}}" max="{{limits.freqMax}}" required
                           ng-model="selectedEvent.highFrequencyHertz"/>
                    <fieldset>
                        <legend>Annotation options</legend>
                        <label>
                            <input type="checkbox" ng-model="selectedEvent.isReference">&nbsp;Is reference tag?
                        </label>
                    </fieldset>
                    <p>
                        data for tag: ({{selectedEvent.startTimeSeconds}}, {{selectedEvent.endTimeSeconds}});
                        ({{selectedEvent.lowFrequencyHertz}}, {{selectedEvent.highFrequencyHertz}});
                        {{selectedEvent.isReference}};
                        <span ng-bind="selectedEvent.tags"></span>
                    </p>
                    <button type="button" ng-click="reset()">Clear</button>
                    <button ng-click="addAnnotation()">Add annotation</button>

                </form>
            </div>
            <div id="listenTableColumn">
                <h3>Annotations</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Annotation ID</th>
                        <th>Audio Recording</th>
                        <th>Created At</th>
                        <th>Created By</th>
                        <th>Deleted At</th>
                        <th>Deleted By</th>
                        <th>Updated At</th>
                        <th>Updated By</th>
                        <th>Tags</th>
                        <th>Time Range</th>
                        <th>Frequency Range</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="ae in model.audioEvents">
                        <td colspan="{{ae.id && 1 || 2}}">
                            {{ae.id}}
                    <span ng-hide="ae.id">
                        <em>new annotation</em>
                    </span>
                        </td>
                        <td ng-show="ae.id"><a ng-href="/recordings/{{ae.audioRecording.uuid}}"
                                               class="short-guid">{{ae.audioRecording.uuid}}</a></td>
                        <td>{{ae.createdAt}}</td>
                        <td>{{ae.creatorId}}</td>
                        <td>{{ae.deletedAt}}</td>
                        <td>{{ae.deleterId}}</td>
                        <td>{{ae.updatedAt}}</td>
                        <td>{{ae.updaterId}}</td>
                        <td><span ng-repeat="t in ae.audioEventTags">{{t.tagId}},</span></td>
                        <td>{{ae.startTimeSeconds}} - {{ae.endTimeSeconds}}</td>
                        <td>{{ae.lowFrequencyHertz}} - {{ae.highFrequencyHertz}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <baw-debug-info></baw-debug-info>
    </div>
</div>